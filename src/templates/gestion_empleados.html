<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Empleados</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/gestion_empleados.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    {% include 'navbar.html' %}
    <div class="container">
        <main class="main-content">
            <div class="table-container">
                <h1><i class="fas fa-users"></i> Gestión de Empleados</h1>

                <div class="table-actions">
                    <a href="{{ url_for('formulario_empleado') }}" class="btn-verde">
                        <i class="fas fa-plus"></i> Añadir Empleado
                    </a>
                    <div class="actions-right">
                        <div class="search-box">
                            <input type="text" placeholder="Buscar empleado..." id="searchInput">
                            <button class="btn-search" id="searchButton">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table" id="empleadosTable">
                        <thead>
                            <tr>
                                <th data-column="sucursal">Sucursal <i class="fas fa-sort sort-icon"></i></th>
                                <th data-column="rol">Rol <i class="fas fa-sort sort-icon"></i></th>
                                <th data-column="nombre_completo">Nombre Completo <i class="fas fa-sort sort-icon"></i></th>
                                <th data-column="tipo_contrato">Tipo Contrato <i class="fas fa-sort sort-icon"></i></th>
                                <th data-column="estatus">Estatus <i class="fas fa-sort sort-icon"></i></th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="empleadosBody">
                            {% for empleado in empleados %}
                            <tr class="employee-row" data-id="{{ empleado.ID }}">
                                <td>{{ empleado.sucursal_nombre if empleado.sucursal_nombre else (empleado.Sucursal_ID if empleado.Sucursal_ID else '-') }}</td>
                                <td>{{ empleado.rol_nombre if empleado.rol_nombre else empleado.Rol_ID }}</td>
                                <td>{{ empleado.Nombre }} {{ empleado.Apellido_P }} {{ empleado.Apellido_M if empleado.Apellido_M else '' }}</td>
                                <td>{{ empleado.Tipo_Contrato if empleado.Tipo_Contrato else '-' }}</td>
                                <td><span class="status-tag status-{{ empleado.Estatus.lower() }}">{{ empleado.Estatus }}</span></td>
                                <td class="actions">
                                    <div class="dropdown">
                                        <button class="btn-action btn-dropdown"><i class="fas fa-ellipsis-v"></i></button>
                                        <div class="dropdown-content">
                                            <a href="#" class="action-item view-details-btn" data-id="{{ empleado.ID }}"><i class="fas fa-eye"></i> Ver Detalles</a>
                                            <a href="#" class="action-item edit-btn" data-id="{{ empleado.ID }}"><i class="fas fa-edit"></i> Editar</a>
                                            <a href="#" class="action-item delete-btn" data-id="{{ empleado.ID }}"><i class="fas fa-trash-alt"></i> Eliminar</a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="details-row" id="details-row-{{ empleado.ID }}">
                                <td colspan="6">
                                    <div class="expanded-details">
                                        <div class="details-grid">
                                            <div class="detail-group"><label><i class="fas fa-id-badge"></i> ID:</label><p>{{ empleado.ID }}</p></div>
                                            <div class="detail-group"><label><i class="fas fa-envelope"></i> Correo:</label><p>{{ empleado.Correo }}</p></div>
                                            <div class="detail-group"><label><i class="fas fa-phone"></i> Teléfono:</label><p>{{ empleado.Telefono if empleado.Telefono else 'N/A' }}</p></div>
                                            <div class="detail-group"><label><i class="fas fa-birthday-cake"></i> Fecha Nacimiento:</label><p>{{ empleado.Fecha_Nacimiento }}</p></div>
                                            <div class="detail-group"><label><i class="fas fa-venus-mars"></i> Género:</label><p>{{ empleado.Genero }}</p></div>
                                            <div class="detail-group"><label><i class="fas fa-money-bill-wave"></i> Salario:</label><p>${{ "%.2f" | format(empleado.Salario) }}</p></div>
                                            <div class="detail-group"><label><i class="fas fa-calendar-check"></i> Contratación:</label><p>{{ empleado.Fecha_Contratacion }}</p></div>
                                            <div class="detail-group"><label><i class="fas fa-calendar-times"></i> Terminación:</label><p>{{ empleado.Fecha_Terminacion if empleado.Fecha_Terminacion else 'N/A' }}</p></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                            <!-- FILA DE PAGINACION -->
                            <tr class="pagination-row">
                                <td colspan="6" style="text-align:center; padding: 1rem 0;">
                                    <div class="pagination-controls">
                                        <button id="prevPage" class="btn-pagination">Anterior</button>
                                        <span id="currentPage" class="current-page-num">1</span>
                                        <button id="nextPage" class="btn-pagination">Siguiente</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination-info-container">
                    <span id="paginationInfo"></span>
                </div>
            </div>
        </main>
    </div>

    <div id="editEmployeeModal" class="modal">
        <div class="modal-content large-modal">
            <span class="close-button">&times;</span>
            <h2><i class="fas fa-user-edit"></i> Editar Empleado</h2>
            <form id="editEmployeeForm" method="POST">
                <div class="form-grid">
                    <div class="form-column">
                        <div class="form-group">
                            <label for="edit_Sucursal_ID"><i class="fas fa-store"></i> Sucursal *</label>
                            <select name="Sucursal_ID" id="edit_Sucursal_ID" required>
                                <option value="">Seleccione una sucursal</option>
                                {% for sucursal in sucursales %}
                                <option value="{{ sucursal.ID }}">{{ sucursal.Nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="edit_Rol_ID"><i class="fas fa-user-tag"></i> Rol *</label>
                            <select name="Rol_ID" id="edit_Rol_ID" required>
                                <option value="">Seleccione un rol</option>
                                {% for rol in roles %}
                                <option value="{{ rol.ID }}">{{ rol.Nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="edit_Nombre"><i class="fas fa-user"></i> Nombre *</label>
                            <input type="text" id="edit_Nombre" name="Nombre" required>
                        </div>

                        <div class="form-group">
                            <label for="edit_Apellido_p"><i class="fas fa-user"></i> Apellido Paterno *</label>
                            <input type="text" id="edit_Apellido_p" name="Apellido_p" required>
                        </div>

                        <div class="form-group">
                            <label for="edit_Apellido_M"><i class="fas fa-user"></i> Apellido Materno</label>
                            <input type="text" id="edit_Apellido_M" name="Apellido_M">
                        </div>
                    </div>

                    <div class="form-column">
                        <div class="form-group">
                            <label for="edit_Correo"><i class="fas fa-envelope"></i> Correo *</label>
                            <input type="email" id="edit_Correo" name="Correo" required>
                        </div>

                        <div class="form-group">
                            <label for="edit_Telefono"><i class="fas fa-phone"></i> Teléfono</label>
                            <input type="text" id="edit_Telefono" name="Telefono" pattern="[0-9]{10}" placeholder="10 dígitos">
                        </div>

                        <div class="form-group">
                            <label for="edit_Fecha_Nacimiento"><i class="fas fa-birthday-cake"></i> Fecha de nacimiento *</label>
                            <input type="date" id="edit_Fecha_Nacimiento" name="Fecha_Nacimiento" required>
                        </div>

                        <div class="form-group">
                            <label for="edit_Genero"><i class="fas fa-venus-mars"></i> Género *</label>
                            <select id="edit_Genero" name="Genero" required>
                                <option value="">Seleccione</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Femenino">Femenino</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-column">
                        <div class="form-group">
                            <label for="edit_Estatus"><i class="fas fa-check-circle"></i> Estatus</label>
                            <select id="edit_Estatus" name="Estatus">
                                <option value="Activo">Activo</option>
                                <option value="Inactivo">Inactivo</option>
                                <option value="Suspendido">Suspendido</option>
                                <option value="Vacaciones">Vacaciones</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="edit_Salario"><i class="fas fa-money-bill-wave"></i> Salario</label>
                            <input type="number" name="Salario" id="edit_Salario" step="0.01" min="0" placeholder="0.00">
                        </div>

                        <div class="form-group">
                            <label for="edit_Tipo_Contrato"><i class="fas fa-file-contract"></i> Tipo de Contrato</label>
                            <select id="edit_Tipo_Contrato" name="Tipo_Contrato">
                                <option value="">Seleccione</option>
                                <option value="Tiempo Completo">Tiempo Completo</option>
                                <option value="Medio Tiempo">Medio Tiempo</option>
                                <option value="Temporal">Temporal</option>
                                <option value="Por Horas">Por Horas</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="edit_Fecha_Contratacion"><i class="fas fa-calendar-check"></i> Fecha de contratación *</label>
                            <input type="date" id="edit_Fecha_Contratacion" name="Fecha_Contratacion" required>
                        </div>

                        <div class="form-group">
                            <label for="edit_Fecha_Terminacion"><i class="fas fa-calendar-times"></i> Fecha de terminación</label>
                            <input type="date" id="edit_Fecha_Terminacion" name="Fecha_Terminacion">
                        </div>
                    </div>
                </div>
                <div class="form-footer">
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-save"></i> Guardar Cambios
                    </button>
                    <button type="button" class="btn-reset" id="cancelEditBtn">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="deleteConfirmModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Confirmar Eliminación</h2>
            <p>¿Estás seguro de que quieres eliminar a este empleado?</p>
            <div class="modal-buttons">
                <button id="confirmDeleteBtn" class="btn-confirm-delete">Eliminar</button>
                <button id="cancelDeleteBtn" class="btn-cancel-delete">Cancelar</button>
            </div>
        </div>
    </div>
    <footer class="admin-footer">
        <div class="footer-content">
            <div class="footer-info">
                <p>Sistema Administrativo del Restaurante © 2025</p>
                <p class="dev-team">Equipo de Desarrollo</p>
            </div>
            <ul class="footer-menu">
                <li>
                    <a href="#" class="footer-link">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6m-2 0l-8 5l-8-5h16m0 12H4V8l8 5l8-5v10Z"/>
                        </svg>
                        Contacto
                    </a>
                </li>
                <li>
                    <a href="#" class="footer-link">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12c5.16-1.26 9-6.45 9-12V5l-9-4m0 6c1.4 0 2.8 1.1 2.8 2.5V11c.6 0 1.2.6 1.2 1.3v3.5c0 .6-.6 1.2-1.3 1.2H9.2c-.6 0-1.2-.6-1.2-1.3v-3.5c0-.6.6-1.2 1.2-1.2V9.5C9.2 8.1 10.6 7 12 7m0 1.2c-.8 0-1.5.5-1.5 1.3V11h3V9.5c0-.8-.7-1.3-1.5-1.3Z"/>
                        </svg>
                        Políticas
                    </a>
                </li>
                <li>
                    <a href="#" class="footer-link">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M13 9h-2V7h2m0 10h-2v-6h2m-1-9A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/>
                        </svg>
                        Acerca de
                    </a>
                </li>
            </ul>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/gestion_empleados.js') }}"></script>
</body>
</html>
